% Written by Emtiyaz, EPFL
% Modified on March 8, 2014
clear all;
close all;

% synthetic data
setSeed(1);
%N = 100; % number of data examples
N = 20; % number of data examples
%D = 10; % feature dimensionality
D = 5; % feature dimensionality
X = [5*rand(N/2,D); -5*rand(N/2,D)]; 
Sigma = X*X' + eye(N); % linear kernel
mu = zeros(N,1); % zero mean
y = mvnrnd(mu, Sigma, 1);
size(y)
y = (y(:)>0);


X(1,1)=2.085110023512870;
X(1,2)=2.095972572016474;
X(1,3)=4.003722843377683;
X(1,4)=0.491734169165250;
X(1,5)=4.944305444532474;
X(2,1)=3.601622467210790;
X(2,2)=3.426097501983798;
X(2,3)=4.841307878596988;
X(2,4)=2.105538125025261;
X(2,5)=3.740828271899197;
X(3,1)=0.000571874086724;
X(3,2)=1.022261248657587;
X(3,3)=1.567120890796214;
X(3,4)=4.789447650752510;
X(3,5)=1.402219960322026;
X(4,1)=1.511662863159199;
X(4,2)=4.390587181954727;
X(4,3)=3.461613078346570;
X(4,4)=2.665826424865085;
X(4,5)=3.946396642257443;
X(5,1)=0.733779454085565;
X(5,2)=0.136937965989631;
X(5,3)=4.381945761480192;
X(5,4)=3.459385569752367;
X(5,5)=0.516130032888210;
X(6,1)=0.461692973843989;
X(6,2)=3.352337550892011;
X(6,3)=4.473033317519237;
X(6,4)=1.577578155030315;
X(6,5)=2.239467630879526;
X(7,1)=0.931301056888355;
X(7,2)=2.086524011835635;
X(7,3)=0.425221056848890;
X(7,4)=3.432504638407918;
X(7,5)=4.542977515465478;
X(8,1)=1.727803635215239;
X(8,2)=2.793449142228758;
X(8,3)=0.195273916164412;
X(8,4)=4.173128359486864;
X(8,5)=1.468070741868397;
X(9,1)=1.983837371153350;
X(9,2)=0.701934692976169;
X(9,3)=0.849152097822845;
X(9,4)=0.091441386720959;
X(9,5)=1.438876692931744;
X(10,1)=2.694083670016785;
X(10,2)=0.990507445424394;
X(10,3)=4.390712517147065;
X(10,4)=3.750721574724837;
X(10,5)=0.650142860591388;
X(11,1)=-0.096834789351485;
X(11,2)=-0.511672144139129;
X(11,3)=-4.517009576439418;
X(11,4)=-4.416530456029049;
X(11,5)=-0.573729864766876;
X(12,1)=-3.394177664699455;
X(12,2)=-2.070279939097841;
X(12,3)=-0.687373520731188;
X(12,4)=-3.118361035278045;
X(12,5)=-4.747446293535356;
X(13,1)=-1.058140580000295;
X(13,2)=-3.472000788638725;
X(13,3)=-0.696381736253793;
X(13,4)=-3.754712170136686;
X(13,5)=-2.249560667399702;
X(14,1)=-1.327733296861131;
X(14,2)=-2.070896347634513;
X(14,3)=-4.036956443547619;
X(14,4)=-1.744491709889213;
X(14,5)=-2.891948071935659;
X(15,1)=-2.457865796401691;
X(15,2)=-0.249767294730436;
X(15,3)=-1.988384184927668;
X(15,4)=-1.349639458825130;
X(15,5)=-2.040684013806406;
X(16,1)=-0.266812725585402;
X(16,2)=-2.679482029577558;
X(16,3)=-0.826770985584664;
X(16,4)=-4.479431090980334;
X(16,5)=-1.185134901215139;
X(17,1)=-2.870588027460065;
X(17,2)=-3.318973226098944;
X(17,3)=-4.637542901980169;
X(17,4)=-2.140455949356475;
X(17,5)=-4.516897602811269;
X(18,1)=-0.733642874529051;
X(18,2)=-2.574445560291543;
X(18,3)=-1.738829298727533;
X(18,4)=-4.824200235741928;
X(18,5)=-2.868397433361429;
X(19,1)=-2.946527684516421;
X(19,2)=-4.722973779954066;
X(19,3)=-3.754060515680778;
X(19,4)=-3.317207489092240;
X(19,5)=-0.014351635155795;
X(20,1)=-3.498791800104656;
X(20,2)=-2.932775202509965;
X(20,3)=-3.629989926752257;
X(20,4)=-3.108478601045609;
X(20,5)=-3.085724568103619;
y(1,1)=1;
y(2,1)=1;
y(3,1)=0;
y(4,1)=1;
y(5,1)=0;
y(6,1)=1;
y(7,1)=1;
y(8,1)=1;
y(9,1)=1;
y(10,1)=1;
y(11,1)=0;
y(12,1)=0;
y(13,1)=0;
y(14,1)=0;
y(15,1)=0;
y(16,1)=0;
y(17,1)=0;
y(18,1)=0;
y(19,1)=0;
y(20,1)=0;

% optimizers options
optMinFunc = struct('Display', 1,...
    'Method', 'lbfgs',...
    'DerivativeCheck', 'off',...
    'LS', 2,...
    'MaxIter', 1000,...
    'MaxFunEvals', 1000,...
    'TolFun', 1e-4,......
    'TolX', 1e-4);

% load bound
load('llp.mat'); 

% optimize wrt m (see function simpleVariational.m for details)
m0 = mu; % initial value all zero
v = ones(N,1); % fix v to 1
Omega = inv(Sigma);
[m, logLik] = minFunc(@simpleVariational, m0, optMinFunc, y, X, mu, Omega, v, bound);
disp('m=')
disp(m)
disp('logLik=')
disp(logLik)

% plot
%figure(1)
%imagesc(Sigma); colorbar;
%title('GP Kernel matrix');

%figure(2)
%stem(y);
%hold on
%plot(1./(1+exp(-m)), '*r','markersize', 10);
%ylim([-0.05 1.05]);
%ylabel('Prediction for training data');

